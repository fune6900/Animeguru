<% content_for(:title, @seichi_memo.title) %>
<%# OGP„ÅÆÂêÑÁ®ÆË®≠ÂÆö %>
<% content_for :meta_description, "#{@seichi_memo.title}„Å®„ÅÑ„ÅÜ„Çø„Ç§„Éà„É´„Åß„ÄÅËÅñÂú∞„É°„É¢„ÇíÊäïÁ®ø„Åó„Å¶„ÅÑ„Çã„ÄÇ" %>

<%# X„Ç∑„Çß„Ç¢Áî®ÊÉÖÂ†± %>
<% content_for :og_title, @seichi_memo.title %>
<% content_for :og_description, truncate(@seichi_memo.body, length: 100) %>

<div class="max-w-3xl mx-auto px-4 sm:px-6 md:px-8 py-6 space-y-6 bg-white shadow-lg rounded-lg">
  <!-- „Çø„Ç§„Éà„É´ -->
  <div class="flex justify-start items-center">
    <h1 class="text-2xl font-bold"><%= @seichi_memo.title %></h1>
  </div>

	<!-- „É¶„Éº„Ç∂„ÉºÊÉÖÂ†±„Ç®„É™„Ç¢ -->
  <div class="flex items-center justify-between px-2 py-2 mt-4">
    <!-- Â∑¶ÔºöÁîªÂÉèÔºã„É¶„Éº„Ç∂„ÉºÂêçÔºãÊäïÁ®øÊó• -->
    <div class="flex items-center space-x-2">
      <%= link_to (@seichi_memo.user == current_user ? profile_path : user_path(@seichi_memo.user)) do %>
        <%= image_tag @seichi_memo.user.profile_image.url, alt: @seichi_memo.user.username, class: "w-10 h-10 rounded-full" %>
      <% end %>
      <div class="flex flex-col justify-center">
        <p class="text-sm text-gray-800 font-semibold"><%= @seichi_memo.user.username %></p>
        <p class="text-sm text-gray-500"><%= @seichi_memo.created_at.strftime("%YÂπ¥%mÊúà%dÊó•") %></p>
      </div>
    </div>

    <!-- Âè≥ÔºöÁ∑®ÈõÜ„ÉªÂâäÈô§„Éú„Çø„É≥ -->
    <% if current_user == @seichi_memo.user %>
      <div class="flex space-x-2">
        <%= link_to edit_seichi_memo_path(@seichi_memo), class: "btn bg-primary text-white shadow-md flex items-center space-x-1" do %>
          <i class="fas fa-pen"></i>
          <span>Á∑®ÈõÜ</span>
        <% end %>

        <%= link_to seichi_memo_path(@seichi_memo),
                    data: { turbo_method: :delete, turbo_confirm: 'Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü' },
                    class: "btn bg-primary text-white shadow-md flex items-center space-x-1" do %>
          <i class="fas fa-trash-alt"></i>
          <span>ÂâäÈô§</span>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- üîπ ËÅñÂú∞„ÅÆÂÜôÁúü & „Ç¢„Éã„É°„ÅÆ„Ç∑„Éº„É≥ -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
    <!-- „Ç¢„Éã„É°„ÅÆ„Ç∑„Éº„É≥ -->
    <div class="h-60">
      <%= image_tag (@seichi_memo.scene_image.present? ? @seichi_memo.scene_image.url : SceneImageUploader.new.default_url(:show)), 
        class: "rounded-lg shadow-md w-full h-full object-cover" %>
    </div>

    <!-- ËÅñÂú∞„ÅÆÂÆüÈöõ„ÅÆÂÜôÁúü -->
    <div class="h-60">
      <%= image_tag (@seichi_memo.seichi_photo.present? ? @seichi_memo.seichi_photo.url : SeichiPhotoUploader.new.default_url(:show)), 
        class: "rounded-lg shadow-md w-full h-full object-cover" %>
    </div>
  </div>

  <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥(„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØ„ÄÅ„ÅÑ„ÅÑ„Å≠„ÄÅX„Åß„ÅÆÂÖ±Êúâ) -->
  <div class="flex items-center justify-between mb-2 px-4">
    <div class="flex items-center gap-4">
      <%= render 'likes/like_buttons', seichi_memo: @seichi_memo %>
      <%= render 'bookmarks/bookmark_buttons', seichi_memo: @seichi_memo %>
    </div>

    <div class="flex items-center gap-4">
      <!-- „Ç∑„Çß„Ç¢„Éú„Çø„É≥ -->
      <%= render "shared/x_share_button", review: @review %>
    </div>
  </div>

  <!-- ‰ΩúÊàê„Ç∏„É£„É≥„É´ -->
  <% if @seichi_memo.genre_tags.present? %>
    <div class="flex flex-wrap gap-2 mt-2">
      <% @seichi_memo.genre_tags.each do |genre_tag| %>
        <%  if current_user && current_user.bookmark?(@seichi_memo) %>
          <%= link_to bookmarks_seichi_memos_path(current_user, q: { genre_tags_name_eq: genre_tag.name }), 
                      class: "bg-primary text-gray-700 text-xs font-medium px-2 py-0.5 rounded-full hover:bg-secondary" do %>
            <%= genre_tag.name %>
          <% end %>
        <% else %>
          <%= link_to seichi_memos_path(q: { genre_tags_name_eq: genre_tag.name }), 
                      class: "bg-primary text-gray-700 text-xs font-medium px-2 py-0.5 rounded-full hover:bg-secondary" do %>
            <%= genre_tag.name %>
          <% end %>
        <% end %>
      <% end %>
    </div>
  <% end %>

  <!-- ËÅñÂú∞„É°„É¢„ÅÆÊú¨Êñá -->
	<div class="p-4">
	  <h2 class="text-lg font-bold">„É°„É¢</h2>
    <p class="text-gray-700"><%= simple_format(@seichi_memo.body) %></p>
	</div>

  <!-- ËÅñÂú∞„ÅÆÊÉÖÂ†± -->
  <div class="border-t border-gray-300 p-4 space-y-2">
    <h2 class="text-lg font-bold mb-2">ËÅñÂú∞ÊÉÖÂ†±</h2>

    <div class="flex items-start space-x-3">
      <i class="fas fa-map text-primary text-lg w-6 text-center"></i>
      <span class="text-gray-700"><%= @seichi_memo.place.name %></span>
    </div>

    <div class="flex items-start space-x-3">
      <i class="fas fa-map-marker-alt text-primary text-lg w-6 text-center"></i>
      <span class="text-gray-700"><%= @seichi_memo.place.address.presence || "ÊÉÖÂ†±„Å™„Åó" %></span>
    </div>

    <div class="flex items-start space-x-3">
      <i class="fas fa-envelope text-primary text-lg w-6 text-center"></i>
      <span class="text-gray-700"><%= @seichi_memo.place.postal_code.presence || "ÊÉÖÂ†±„Å™„Åó" %></span>
    </div>
  </div>

  <!-- ‰ΩúÂìÅÊÉÖÂ†± -->
  <div class="border-t border-gray-300 p-4 space-y-2">
    <h2 class="text-lg font-bold mb-2">‰ΩúÂìÅÊÉÖÂ†±</h2>

    <div class="flex items-start space-x-3">
      <i class="fas fa-film text-primary text-lg w-6 text-center"></i>
      <span class="text-gray-700"><%= @seichi_memo.anime.title %></span>
    </div>

    <div class="flex items-start space-x-3">
      <i class="fas fa-link text-primary text-lg w-6 text-center"></i>
      <% if @seichi_memo.anime.official_site_url.present? %>
        <a href="<%= @seichi_memo.anime.official_site_url %>" target="_blank" class="text-blue-500 hover:underline flex items-center space-x-1">
          <span>ÂÖ¨Âºè„Çµ„Ç§„Éà</span>
          <i class="fas fa-up-right-from-square text-sm"></i>
        </a>
      <% else %>
        <span class="text-gray-500">„É™„É≥„ÇØ„Å™„Åó</span>
      <% end %>
    </div>

    <div class="mt-4 flex justify-center">
      <%= image_tag(
        @seichi_memo.anime.image_url.present? ? @seichi_memo.anime.image_url.url : AnimeImageUploader.new.default_url,
        class: "rounded-lg shadow-md w-2/3 object-cover"
      ) %>
    </div>
  </div>


  <!-- „Ç≥„É°„É≥„Éà„Çª„ÇØ„Ç∑„Éß„É≥ -->
  <div class="border-t border-gray-300 p-4">
    <!-- „Ç≥„É°„É≥„Éà‰ª∂Êï∞Ë°®Á§∫ -->
    <h2 id="comments_count" class="text-base text-black font-semibold mb-3"><%= @comments.count %>‰ª∂„ÅÆ„Ç≥„É°„É≥„Éà</h2>

    <!-- „Éï„É©„ÉÉ„Ç∑„É•„É°„ÉÉ„Çª„Éº„Ç∏ -->
    <div id="flash" class="mb-5">
      <%= render "shared/flash_message_turbo" %>
    </div>

    <!-- „Ç≥„É°„É≥„Éà„Éï„Ç©„Éº„É† -->
    <%= render partial: "comments/form", locals: { seichi_memo: @seichi_memo, comment: @comment } %>

    <!-- „Ç≥„É°„É≥„Éà‰∏ÄË¶ß -->
    <%= render partial: "comments/comments", locals: { comments: @comments } %>
  </div>

  <!-- „Éú„Çø„É≥„Ç®„É™„Ç¢ -->
  <div class="flex flex-col items-center space-y-4 mt-8">
    <%= link_to "https://www.google.com/maps/search/?api=1&query=#{CGI.escape(@seichi_memo.place.name.to_s + ' ' + @seichi_memo.place.address.to_s)}", target: "_blank", class: "btn bg-primary text-white py-2 px-6 shadow-md transition duration-200 w-full max-w-xs" do %>
      <i class="fa-solid fa-map-location-dot"></i>
      <span>„Åì„Åì„Å∏Ë°å„Åè</span>
    <% end %>

    <%= link_to "„Åø„Çì„Å™„ÅÆÊäïÁ®ø„Å´Êàª„Çã", seichi_memos_path, class: "btn bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-lg shadow-md transition duration-200 w-full max-w-xs" %>
  </div>
</div>
